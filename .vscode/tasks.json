{
    // See https://go.microsoft.com/fwlink/?LinkId=733558
    // for the documentation about the tasks.json format
    "version": "2.0.0",
    "tasks": [
        {
            "label": "stop qemu",
            "type": "shell",
            "command": "pkill qemu-system-x86_64 -f",
            "problemMatcher": [],
            // https://stackoverflow.com/questions/47946868/how-to-get-rid-of-terminal-will-be-reused-by-tasks-press-any-key-to-close-it
            // 自动关闭task
            // 不显示 Terminal will be reused by tasks, press any key to close it
            "presentation": {
                "reveal": "silent",
                "revealProblems": "onProblem",
                "close": true
            }
        },
        {
            "label": "start qemu",
            "type": "process",
            // presentation 和 isBackground:true 配合
            // 可以关掉
            // the task cannot be tracked. Make sure to have a problem matcher defined 弹框

            // https://stackoverflow.com/questions/47946868/how-to-get-rid-of-terminal-will-be-reused-by-tasks-press-any-key-to-close-it
            // 自动关闭task
            // 不显示 Terminal will be reused by tasks, press any key to close it
            "presentation": {
                "reveal": "silent",
                "revealProblems": "onProblem",
                "close": true
            },
            "isBackground": true,
            "command": "qemu-system-x86_64",
            "args": [
                // 默认是128MB
                // 如果initrd过大，会导致Initramfs unpacking failed
                // 改用更大的startup memory
                // https://wiki.archlinux.org/title/QEMU#Installing_the_operating_system
                "-m",
                "8G",
                "-smp",
                "cpus=4,cores=4",
                "--kernel",
                // "${workspaceFolder}/buildroot/output/images/bzImage",
                "${workspaceFolder}/linux/arch/x86_64/boot/bzImage",
                "-initrd",
                "${workspaceFolder}/buildroot/output/images/rootfs.cpio.gz",
                "-drive",
                "file=${workspaceFolder}/buildroot/output/images/rootfs.ext4,format=raw,index=0,media=disk",
                "-device",
                "e1000,netdev=eth0",
                "-netdev",
                "user,id=eth0,hostfwd=tcp::5555-:22,net=192.168.76.0/24,dhcpstart=192.168.76.9",
                "-append",
                // https://wiki.archlinux.org/title/kernel_parameters#Hijacking_cmdline
                "nokaslr console=ttyS0 debug",
                "-S",
                "-nographic",
                "-gdb",
                "tcp::1234",
                // 调试 mt7921 驱动
                // "-usb",
                // "-device",
                // "usb-host,vendorid=0x0e8d,productid=0x7961",
                "-virtfs",
                "local,path=/,security_model=none,mount_tag=guestroot"
            ]
        }
    ]
}
